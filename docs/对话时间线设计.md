# 时间线节点类型

## 时间线的起点
- 节点类型：User_Query
- 节点描述：代表用户开始与Agent的交互。
- 节点卡片显示内容取自“message.content”字段值。
- JSON日志片段示例：
```json
{
  "type": "user",
  "message": {
    "role": "user",
    "content": "主题:agent如何设计"
  }
}
```

## Agent思考节点
- 节点类型：Agent_Thinking
- 节点描述：Agent在思考中，根据用户输入和之前的对话历史，生成下一个回复。
- 节点卡片显示内容取自“message.content”字段值中“thinking”字段的内容。
- JSON日志片段示例：
```json
{
  "message": {
    "type": "message",
    "role": "assistant",
    "content": [
      {
        "type": "thinking",
        "thinking": "用户需要在AI零代码验证模块（x_00111901）下，新增办公资产管理功能页面。根据工作要求，我需要：\n\n1. 先使用 analysis-agent 分析用户需求，任务完成后，根据输出的需求文档\n2. 根据需求文档中的内容，选择不同的SubAgent**并行**完成剩下的开发工作\n\n让我先使用 analysis-agent 来分析用户需求。"
      }
    ]
  }
}
```

## Agent消息节点
- 节点类型：Agent_Message
- 节点描述：Agent以文本方式对用户的回复消息。
- 节点卡片显示内容取自“message.content”字段值中“text”字段的内容。
- JSON日志片段示例：
```json
{
  "message": {
    "type": "message",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "我将帮您研究agent设计的相关知识。让我先创建一个待办事项列表来规划这个研究任务。\n"
      }
    ]
  }
}
```

## 工具使用节点
- 节点类型：Tool_Use
- 节点描述：LLM回复中指定要使用某工具来完成任务，此节点记录了工具的名称和参数。
- 节点卡片显示内容取自“message.content”字段值中“name”、"input.command"、"input.description"字段的内容。
- JSON日志片段示例：
```json
{
  "message": {
    "type": "message",
    "role": "assistant",
    "content": [
      {
        "type": "tool_use",
        "id": "toolu_01D12EwaaQkFGnVhtKtXRgxa",
        "name": "Bash",
        "input": {
          "command": "node tools/get_session_id.js",
          "description": "获取当前会话的sessionId作为文档ID"
        }
      }
    ]
  }
}
```

## 工具结果节点
- 节点类型：Tool_Result
- 节点描述：Agent调用工具后，会在日志里记录工具执行的结果，与“工具使用节点”是成对出现的，它们之间用tool_use_id关联起来。此节点不显示在时间线上，而是与对应的Tool_Use节点用线关联起来。
- 节点卡片显示内容取自“toolUseResult.stdout”字段内容。
- JSON日志片段示例：
```json
{
  "type": "user",
  "message": {
    "role": "user",
    "content": [
      {
        "tool_use_id": "toolu_01D12EwaaQkFGnVhtKtXRgxa",
        "type": "tool_result",
        "content": "43798ecc-7b36-49bd-9d38-cdce8f120acd",
        "is_error": false
      }
    ]
  },
  "toolUseResult": {
    "stdout": "43798ecc-7b36-49bd-9d38-cdce8f120acd",
    "stderr": "",
    "interrupted": false,
    "isImage": false
  }
}
```

## 子代理节点
- 节点类型：Agent_Child
- 节点描述：Agent调用子代理后，会在日志里记录子代理执行的结果。它也是一种工具使用，不过工具固定为“Task”，参数为子代理的类型和描述。它也有工具结果节点，记录子代理执行的结果。
- 节点卡片显示内容取自“message.content”字段值中“input.subagent_type”、"input.description"字段的内容。
- 子代理开始任务的JSON日志片段示例：
```json
{
  "message": {
    "type": "message",
    "role": "assistant"
    "content": [
      {
        "type": "tool_use",
        "id": "toolu_01UCPrKogQTAQh6zkYxVafiY",
        "name": "Task",
        "input": {
          "subagent_type": "analysis-agent",
          "description": "分析办公资产管理需求",
          "prompt": "用户需求内容：\n在AI零代码验证模块（x_00111901）下，新增办公资产管理功能页面，详细要求如下：\n\n1. 办公资产数据表包含：资产名称、资产编号（唯一）、资产类型（耗材、桌椅、电脑、打印机）、资产数量、仓库地址、采购单（附件）；\n- 注意：表英文名增加时间戳（如：1758681904），防止表名重复；\n\n2. 办公资产管理列表页面：可以根据名称、和编号以及类型来查看所有办公资产信息，列表支持以下几种操作：\n- 操作按钮：新增（弹出框打开资产表单）、更多菜单（导出、打印）\n- 行操作按：删除、编辑和详情弹出框打开资产表单；\n\n3. 办公资产管理表单页面：可以通过新增方式录入办公资产信息以及编辑和查看办公资产信息详情，表单支持以下几种操作：\n- 操作按钮：保存（保存&关闭）、取消（关闭弹出框）\n\n请严格按照 analysis-agent 的指导完成需求分析，生成详细的需求分析文档。"
        }
      }
    ]
  }
}
```
- 子代理完成任务时的JSON日志片段：
```json
{
  "type": "user",
  "message": {
    "role": "user",
    "content": [
      {
        "tool_use_id": "toolu_01UCPrKogQTAQh6zkYxVafiY",
        "type": "tool_result",
        "content": [
          {
            "type": "text",
            "text": "需求分析文档已成功完成。根据 analysis-agent 的指导，我已经严格按照建模开发必读的框架生成了详细的需求分析文档，包含以下关键内容：\n\n## 完成的需求分析内容：\n\n**1. 应用信息** - 确认了售楼系统的基本信息\n**2. 模块信息** - 使用现有的AI零代码验证模块（x_00111901）\n**3. 数据表信息** - 设计了办公资产表，包含7个字段，符合数据表字段设计规范\n**4. 页面信息** - 设计了列表页面和表单页面的详细配置\n**5. 文件信息** - 提供了需要执行的node脚本和页面访问地址\n\n## 生成的关键ID信息：\n- 文档ID：`43798ecc-7b36-49bd-9d38-cdce8f120acd`\n- 数据表ID：`9c491cd0-bf93-4fcc-907e-b1ec8f2a98bd`\n- 列表页面ID：`c6860f17-3856-4be4-8d65-645d3bdabad5`\n- 表单页面ID：`fad112ad-724f-4889-b9b6-f34699c27c81`\n- 列表控件ID：`f20431c8-0101-45e1-8ba8-46d1ec5572f9`\n- 表单控件ID：`058b88e4-3b6b-485c-9306-e1917d1a7d20`\n\n需求分析文档已保存在 `/Users/ligf/工作/Code/cc-ai-modeling/specs/43798ecc-7b36-49bd-9d38-cdce8f120acd.md`，可供后续的 SubAgent 开发使用。"
          }
        ]
      }
    ]
  },
  "toolUseResult": {
    "content": [
      {
        "type": "text",
        "text": "需求分析文档已成功完成。根据 analysis-agent 的指导，我已经严格按照建模开发必读的框架生成了详细的需求分析文档，包含以下关键内容：\n\n## 完成的需求分析内容：\n\n**1. 应用信息** - 确认了售楼系统的基本信息\n**2. 模块信息** - 使用现有的AI零代码验证模块（x_00111901）\n**3. 数据表信息** - 设计了办公资产表，包含7个字段，符合数据表字段设计规范\n**4. 页面信息** - 设计了列表页面和表单页面的详细配置\n**5. 文件信息** - 提供了需要执行的node脚本和页面访问地址\n\n## 生成的关键ID信息：\n- 文档ID：`43798ecc-7b36-49bd-9d38-cdce8f120acd`\n- 数据表ID：`9c491cd0-bf93-4fcc-907e-b1ec8f2a98bd`\n- 列表页面ID：`c6860f17-3856-4be4-8d65-645d3bdabad5`\n- 表单页面ID：`fad112ad-724f-4889-b9b6-f34699c27c81`\n- 列表控件ID：`f20431c8-0101-45e1-8ba8-46d1ec5572f9`\n- 表单控件ID：`058b88e4-3b6b-485c-9306-e1917d1a7d20`\n\n需求分析文档已保存在 `/Users/ligf/工作/Code/cc-ai-modeling/specs/43798ecc-7b36-49bd-9d38-cdce8f120acd.md`，可供后续的 SubAgent 开发使用。"
      }
    ]
  }
}
```


## 时间线的终点：
- 节点类型：Agent_End
- 节点描述：对话日志JSON的最后一条记录，代表Agent对话结束。一般是Agent回复用户的消息。
- 节点卡片显示内容取自“message.content”字段值中“text”字段的内容。
```json
{
  "message": {
    "type": "message",
    "role": "assistant",
    "content": [
      {
        "type": "text",
        "text": "## Agent设计研究完成\n\n我已经完成了关于agent设计的研究工作。根据您提供的信息源（LangChain博客和Anthropic研究），我获取了大量关于agent设计的专业知识。\n\n### 研究成果\n\n**获取的主要信息**：\n1. **LangGraph架构设计** - 了解了生产级agent的六大核心需求和底层设计原则\n2. **深度智能体模式** - 掌握了四个核心组件：详细系统提示、规划工具、子智能体、文件系统\n3. **中间件架构** - 学习了可组合的agent中间件设计模式\n4. **智能体基础设施** - 理解了长时间运行agent的基础设施需求\n5. **安全与对齐** - 从Anthropic研究获得了关于agent安全性的重要见解\n\n**生成的文档**：\n- `docs/langchain-blog/` 目录下的5篇详细技术文档\n- `docs/anthropic-research/` 目录下的研究概述\n- `results/agent-design-research-2025-10-03.md` 最终知识文档\n\n### 核心发现\n\nAgent设计的关键在于理解LLM的特性（慢、不稳定、开放式）并为此构建合适的架构。成功的agent设计需要平衡控制性、灵活性、性能和安全性等多个因素。\n\n所有信息都已按照您的要求保存为简体中文的markdown文档，可供后续参考使用。"
      }
    ]
  }
}
```

# 功能要求
- 除了“工具结果节点”节点以外，每类节点都显示在时间线上，不同类节点的颜色不一样，方便用户快速识别不同类型的节点。
- 每个节点的时间取自对应日志的“timestamp”字段值，这是UTC时区格式，需要转换为中国时区显示。
- 节点的时间显示格式为：“时:分:秒”，例如：“14:30:00”，显示在节点左侧。
- 节点与节点之间显示耗时，规则如下：
  - 如果小于1秒，显示为“<1s”；
  - 如果大于1秒，按”xhymzs“格式显示，例如："1h23m50s"，代表1小时23分50秒。
- ”工具结果节点“默认收起来，用户有需要时展开查看。（此功能如有难度可暂缓实现）

# 非功能要求
- 时间线的节点卡片显示内容，最多显示200个字符，超出部分用省略号表示。
- 从实现设计上要考虑按需加载，避免一次性加载所有节点，导致性能问题。但目前先不实现按需加载。