# 功能缺陷
- [X] trace日志文件重命名失败，提示：No user_id found in first record, skipping rename

# 重要改进
- [ ] 支持对日志轨迹进行智能分析：
  - 增加轨迹图显示
    - 功能价值：对于复杂任务，cc执行步骤数量会非常多（长达100多步），过程中可能调用很多次工具，启动若干SubAgent，执行日志非常多，不利于人工分析，所以需要有一个轨迹图能够整体性、概要性的展示cc执行轨迹，方便人快速理解执行过程，迅速锁定问题范围。
    - 功能要求：
      - 轨迹图主线体现主日志的执行轨迹，允许点击子代理节点，展开子代理的执行轨迹。
      - 
  - 支持智能分析：
    - 默认分析：按工具内置提示词分析
    - 自定义分析：用户自定义提示词分析
    - 对比分析：用户提供cc日志样例，与当前轨迹对比分析
    - 分析输出：轨迹问题清单、原因分析、改进建议
- [ ] cc调试：支持一次发送多个请求

# 一般改进
- [ ] 支持URL参数传递项目目录路径，当URL有值，则默认以此路径为当前项目目录（注意：当前的选择项目功能要保留，且URL参数优先级高于当前选择）
- [ ] 选择项目对话框增加搜索
- [X] 选择日志下拉框备选项，agent显示名称
- [X] 选择日志文件增加弹出选择页面，树形列表，显示sessionid，开始时间、结束时间、耗时、用户输入（第一个UserQuery日志）
- [X] 切换选择cc项目
- [X] 修复windows环境的若干问题
- [X] cc运行结束时，将cc日志拷贝到.claude-trace/cclog目录，默认从此目录打开cc日志
- [X] 发送llm请求失败，因为llm的URL和key读取错误，应该按如下逻辑读取：
  - 首先从cc项目目录的.claude/settings.local.json中获取环境变量设置；
  - 如果没找到，从全局cc目录的设置文件获取
  - 如果没找到，从全局环境变量获取

# 体验优化
- [ ] 对于sub_agent节点，添加超链接，快速切换到当前子代理对应的日志文件
- [X] 左侧面板支持拖动宽度
- [X] 在日志文件下拉选择面板，为每个日志文件增加步骤数量显示
- [X] 将“代理子节点”和“代理结束”类型合并为“子代理”类型，子代理日志的特征为：message.content[]存在type=tool_use && name=Task && input.subagent_type不为空的元素，那么此日志数据为子代理类型。
- [X] 步骤概览的过滤面板中，对于工具调用类型，增加下一级展开，还可进一步按工具类型过滤：Read、Write、TodoWrite、Bash等
- [X] 步骤图例的颜色与实际步骤类型颜色不一致，比如工具调用类型，图例是橘黄色，但实际上步骤是紫色
- [X] 时间线节点应显示步骤序号，步骤概览中也显示步骤序号，而且过滤后，步骤序号不变
- [X] 点击节点的顶部区域应该也可以展开收起，不用非要点击“展开/收起”按钮
- [X] 对于工具调用和子代理节点，应该显示工具调用的耗时，可通过日志数据中的timestamp字段计算
  - 如果耗时小于3秒，用绿色标签；如果大于3秒小于30秒，用蓝色标签；如果大于30秒小于2分钟，用浅红色标签（目前标签的颜色）；如果大于2分钟，用深红色标签。
- [X] 步骤节点中显示的如果是JSON，应该高亮显示
- [X] 时间线：thinking节点展开后，宽度超长
- [X] 时间线：步骤详情的日志框应该支持自动换行
- [X] 时间线时间格式是UTC，应转换为本地时区
- [X] 步骤详情中的JSON日志框要自动换行显示
- [X] 命令行增加版本命令参数，运行开始也显示版本


