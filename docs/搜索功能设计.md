我先阅读待办清单和相关代码文件，了解当前项目结构，然后设计实现方案。

我先查看一下DetailPanel组件和相关的store，了解当前的数据结构和实现方式。

我需要先查看timeline store和类型定义，了解数据结构和现有功能。

# 全局搜索功能实现方案

基于需求分析和现有代码结构，我设计了以下实现方案：

## 一、整体架构设计

### 1.1 UI布局调整
- 将右侧详情面板改造为Tab页结构，包含两个Tab：
  - **详情面板**（默认选中）：保持现有的步骤详情展示功能
  - **搜索面板**（新增）：提供全局搜索功能

### 1.2 组件结构
```
MainLayout.vue (主布局)
├── DetailPanel.vue (改造为Tab容器)
│   ├── StepDetail.vue (步骤详情组件 - 从DetailPanel拆分)
│   └── SearchPanel.vue (搜索面板组件 - 新建)
```

## 二、详细设计

### 2.1 DetailPanel.vue 改造
**改造内容：**
- 使用 `<a-tabs>` 组件包裹现有内容
- 将现有的步骤详情内容提取到独立组件 `StepDetail.vue`
- 新增搜索面板Tab，引入 `SearchPanel.vue` 组件
- 保持现有的调试按钮等功能

**Tab结构：**
```vue
<a-tabs default-active-key="detail">
  <a-tab-pane key="detail" title="详情面板">
    <StepDetail />
  </a-tab-pane>
  <a-tab-pane key="search" title="搜索面板">
    <SearchPanel />
  </a-tab-pane>
</a-tabs>
```

### 2.2 SearchPanel.vue 新组件设计

**功能模块：**

#### 2.2.1 搜索框区域
- 输入框：使用 `<a-input-search>` 组件
- 支持回车搜索
- 显示搜索结果统计（如：找到 15 个结果，分布在 3 个文件中）

#### 2.2.2 搜索结果展示
使用 `<a-collapse>` 折叠面板组件，层级结构：

**第一级（文件级别）：**
- 显示内容：日志文件名称（主日志显示文件名，子代理日志显示子代理名称）
- 显示结果数量：如 "main.jsonl (5个结果)"
- 默认展开第一个有结果的文件

**第二级（结果列表）：**
每个搜索结果包含：
- **标题层**：
  - 节点类型标签（如 Tool_Use、Agent_Message）
  - 步骤序号（如 #3）
  - 时间戳
- **内容层**：
  - 显示匹配的内容片段（前后各50个字符）
  - 高亮关键字（使用 `<mark>` 标签或自定义样式）
  - 支持点击跳转到对应步骤

### 2.3 数据结构设计

#### 2.3.1 搜索结果接口
```typescript
// 搜索结果项
interface SearchResultItem {
  stepId: string;           // 步骤ID
  stepType: string;         // 步骤类型
  stepIndex: number;        // 步骤序号
  timestamp: string;        // 时间戳
  matchedContent: string;   // 匹配的内容片段
  matchedField: string;     // 匹配的字段路径（如 content、metadata.xxx）
  fileId: string;           // 所属文件ID
  fileName: string;         // 文件名称
}

// 文件级搜索结果
interface FileSearchResult {
  fileId: string;           // 文件ID
  fileName: string;         // 文件名称
  isSubAgent: boolean;      // 是否为子代理日志
  resultCount: number;      // 结果数量
  results: SearchResultItem[]; // 搜索结果列表
}
```

### 2.4 搜索逻辑设计

#### 2.4.1 搜索范围
- 当前主日志及其所有关联的子代理日志
- 搜索字段：
  - 步骤内容（content）
  - 工具参数（parameters）
  - 元数据（metadata）
  - 原始日志（rawLogEntry）的所有文本字段

#### 2.4.2 搜索算法
- 使用简单的字符串包含匹配（不区分大小写）
- 支持多关键词搜索（空格分隔，AND逻辑）
- 提取匹配上下文（前后各50字符）

#### 2.4.3 结果排序
- 按文件分组（主日志优先，子代理日志按名称排序）
- 同一文件内按步骤序号排序

### 2.5 交互设计

#### 2.5.1 搜索交互
- 输入关键词后按回车或点击搜索按钮触发搜索
- 搜索中显示加载状态
- 无结果时显示空状态提示

#### 2.5.2 结果交互
- 点击搜索结果项：
  1. 如果结果在当前日志中，直接定位并高亮对应日志节点
  2. 如果结果在其他日志中，先切换到对应的日志文件，然后定位并高亮对应的步骤节点

#### 2.5.3 关键字高亮
- 在内容片段中使用醒目颜色高亮关键字
- 建议使用黄色背景 + 深色文字

## 三、技术实现要点

### 3.1 Store扩展
在 [timeline.ts](cci:7://file:///Users/ligf/Code/claude-code/ccdebug/web/src/stores/timeline.ts:0:0-0:0) 中新增：
```typescript
// 搜索相关状态
const searchKeyword = ref<string>('')
const searchResults = ref<FileSearchResult[]>([])
const searchLoading = ref(false)

// 搜索方法
const performSearch = async (keyword: string) => {
  // 实现搜索逻辑
}
```

### 3.2 样式设计
- 搜索框：顶部固定，带阴影分隔
- 折叠面板：使用 Arco Design 默认样式，适当调整间距
- 关键字高亮：`background: #fff3cd; color: #856404;`
- 结果项：悬停时显示背景色，提示可点击

### 3.3 性能优化
- 搜索防抖处理（300ms）
- 大量结果时考虑虚拟滚动（如果超过100个结果）
- 内容片段长度限制，避免显示过长文本

## 四、文件清单

### 4.1 需要修改的文件
1. [DetailPanel.vue](cci:7://file:///Users/ligf/Code/claude-code/ccdebug/web/src/components/DetailPanel.vue:0:0-0:0) - 改造为Tab容器
2. [timeline.ts](cci:7://file:///Users/ligf/Code/claude-code/ccdebug/web/src/stores/timeline.ts:0:0-0:0) - 新增搜索相关状态和方法

### 4.2 需要新建的文件
1. `StepDetail.vue` - 步骤详情组件（从DetailPanel拆分）
2. `SearchPanel.vue` - 搜索面板组件

### 4.3 可能需要调整的文件
1. [types/index.ts](cci:7://file:///Users/ligf/Code/claude-code/ccdebug/web/src/types/index.ts:0:0-0:0) - 新增搜索相关类型定义

## 五、开发步骤建议

1. **第一步**：新增类型定义
2. **第二步**：拆分 DetailPanel，创建 StepDetail 组件
3. **第三步**：改造 DetailPanel 为 Tab 结构
4. **第四步**：创建 SearchPanel 基础框架
5. **第五步**：实现搜索逻辑（Store）
6. **第六步**：实现搜索结果展示
7. **第七步**：实现点击跳转功能
8. **第八步**：样式优化和测试

