{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "AppGrid DSL Schema",
  "description": "列表控件JSON模板的Schema定义",
  "type": "object",
  "required": [
    "metadataType",
    "name",
    "gridId",
    "layout_entityName",
    "layout_entityId",
    "views"
  ],
  "properties": {
    "metadataType": {
      "type": "string",
      "description": "当前元数据类型",
      "enum": [
        "AppGrid"
      ]
    },
    "createdBy": {
      "type": "string",
      "description": "创建人"
    },
    "createdOn": {
      "type": "string",
      "format": "date-time",
      "description": "创建时间"
    },
    "modifiedBy": {
      "type": "string",
      "description": "修改人"
    },
    "modifiedOn": {
      "type": "string",
      "format": "date-time",
      "description": "修改时间"
    },
    "metadataStatus": {
      "type": "string",
      "enum": [
        "Product",
        "Customize"
      ],
      "description": "状态，枚举类型：Product｜Customize"
    },
    "name": {
      "type": "string",
      "description": "控件名称"
    },
    "functionPageId": {
      "type": "string",
      "format": "uuid",
      "description": "业务单元ID，GUID类型"
    },
    "description": {
      "type": "string",
      "description": "控件描述"
    },
    "gridId": {
      "type": "string",
      "format": "uuid",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$",
      "description": "列表控件ID"
    },
    "application": {
      "type": "string",
      "description": "应用ID"
    },
    "layout_pageSize": {
      "type": "integer",
      "enum": [20, 50, 100, 200],
      "description": "每页显示记录数"
    },
    "layout_entityName": {
      "type": "string",
      "description": "实体名称"
    },
    "layout_projectFilter": {
      "type": "boolean",
      "description": "是否启用了项目过滤"
    },
    "layout_entityId": {
      "type": "string",
      "format": "uuid",
      "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$",
      "description": "实体ID"
    },
    "toolbar": {
      "type": "object",
      "description": "工具栏配置",
      "properties": {
        "batchButtons": {
          "type": "array",
          "description": "批量操作按钮",
          "items": {
            "type": "object",
            "properties": {}
          }
        },
        "globalButtons": {
          "type": "array",
          "description": "全局按钮",
          "items": {
            "$ref": "#/definitions/button"
          }
        },
        "rowButtons": {
          "type": "array",
          "description": "行按钮",
          "items": {
            "$ref": "#/definitions/button"
          }
        }
      }
    },
    "filter": {
      "type": "object",
      "description": "筛选条件配置",
      "properties": {
        "filterId": {
          "type": "string",
          "format": "uuid",
          "description": "筛选节点ID，GUID类型"
        },
        "labelWidth": {
          "type": "string",
          "description": "筛选标签宽度"
        },
        "conditions": {
          "type": "array",
          "description": "筛选条件数组",
          "items": {
            "$ref": "#/definitions/filterCondition"
          }
        }
      }
    },
    "views": {
      "type": "array",
      "description": "视图配置",
      "items": {
        "$ref": "#/definitions/view"
      },
      "minItems": 1
    },
    "rule": {
      "type": "object",
      "description": "规则配置",
      "properties": {
        "configs": {
          "type": "array",
          "description": "规则配置项",
          "items": {
            "$ref": "#/definitions/ruleConfig"
          }
        },
        "groups": {
          "type": "array",
          "description": "规则组",
          "items": {
            "$ref": "#/definitions/ruleGroup"
          }
        }
      }
    }
  },
  "definitions": {
    "button": {
      "type": "object",
      "required": [
        "itemId",
        "title",
        "type",
        "id"
      ],
      "properties": {
        "itemId": {
          "type": "string",
          "format": "uuid",
          "description": "按钮项ID"
        },
        "title": {
          "type": "string",
          "description": "按钮标题"
        },
        "isHighlight": {
          "type": "boolean",
          "description": "是否高亮显示"
        },
        "type": {
          "type": "string",
          "enum": [
            "button",
            "menu"
          ],
          "description": "按钮类型：button或menu"
        },
        "id": {
          "type": "string",
          "description": "按钮ID"
        },
        "isMenuButton": {
          "type": "boolean",
          "description": "是否为菜单按钮"
        },
        "isHidden": {
          "type": "boolean",
          "description": "是否隐藏"
        },
        "isDisabled": {
          "type": "boolean",
          "description": "是否禁用"
        },
        "events": {
          "type": "array",
          "description": "事件配置",
          "items": {
            "$ref": "#/definitions/event"
          }
        },
        "behavior": {
          "type": ["object","null"],
          "required": ["itemId","target","type","url","id"],
          "properties": {
            "itemId": {
              "type": "string",
              "format": "uuid",
              "description": "节点ID，GUID类型",
              "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
            },
            "target": {
              "type": "string",
              "description": "打开方式",
              "enum": [
                "self",
                "dialog",
                "panel",
                "blank"
              ]
            },
            "targetDisplayType": {
              "type": "string",
              "description": "新标签页打开方式",
              "enum": [
                "fixedWidth",
                "selfAdaption"
              ]
            },
            "type": {
              "type": "string",
              "description": "页面类型",
              "enum": [
                "page"
              ]
            },
            "url": {
              "type": "string",
              "description": "页面运行时访问地址，固定格式：/std/{@functionCode}/{@name}"
            },
            "id": {
              "type": "string",
              "format": "uuid",
              "description": "页面ID，GUID类型",
              "pattern": "^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$"
            },
            "options": {
              "type": "array",
              "items": {
                "type": "object",
                "required": [
                  "key",
                  "value"
                ],
                "properties": {
                  "key": {
                    "type": "string",
                    "description": "配置属性"
                  },
                  "value": {
                    "type": "string",
                    "description": "配置值"
                  }
                }
              }
            },
            "params": {
              "type": "array",
              "items": {
                "type": "object",
                "required": [
                  "key",
                  "value"
                ],
                "properties": {
                  "type": {
                    "type": "string",
                    "description": "参数类型",
                    "enum": [
                      "text",
                      "query",
                      "data",
                      "filter"
                    ]
                  },
                  "key": {
                    "type": "string",
                    "description": "参数名"
                  },
                  "value": {
                    "type": "string",
                    "description": "参数值"
                  }
                }
              }
            }
          }
        },
        "items": {
          "type": "array",
          "description": "子菜单项（仅当type为menu时有效）",
          "items": {
            "$ref": "#/definitions/button"
          }
        }
      }
    },
    "event": {
      "type": "object",
      "required": [
        "name",
        "functionName",
        "enabled"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "事件名称"
        },
        "functionName": {
          "type": "string",
          "description": "事件处理函数名称"
        },
        "enabled": {
          "type": "boolean",
          "description": "是否启用"
        }
      }
    },
    "filterCondition": {
      "type": "object",
      "required": [
        "id",
        "name",
        "title"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "筛选条件ID"
        },
        "name": {
          "type": "string",
          "description": "筛选条件名称"
        },
        "searchType": {
          "type": [
            "string",
            "null"
          ],
          "description": "搜索类型"
        },
        "layout": {
          "type": "string",
          "enum": [
            "horizontal",
            "vertical"
          ],
          "description": "布局方式：horizontal水平、vertical垂直"
        },
        "title": {
          "type": "string",
          "description": "显示标题"
        },
        "projectSelect": {
          "$ref": "#/definitions/projectSelect"
        },
        "search": {
          "$ref": "#/definitions/searchFilter"
        },
        "comboBox": {
          "$ref": "#/definitions/comboBoxFilter"
        },
        "dateRange": {
          "$ref": "#/definitions/dateRangeFilter"
        },
        "numberRange": {
          "$ref": "#/definitions/numberRangeFilter"
        }
      }
    },
    "view": {
      "type": "object",
      "required": [
        "viewId",
        "name",
        "entityId",
        "dataSource",
        "columns"
      ],
      "properties": {
        "viewId": {
          "type": "string",
          "format": "uuid",
          "description": "视图ID"
        },
        "name": {
          "type": "string",
          "description": "视图名称"
        },
        "isDefault": {
          "type": "boolean",
          "description": "是否为默认视图"
        },
        "isHidden": {
          "type": "boolean",
          "description": "是否隐藏"
        },
        "entityId": {
          "type": "string",
          "format": "uuid",
          "description": "实体ID"
        },
        "dataSource": {
          "$ref": "#/definitions/dataSource"
        },
        "columns": {
          "type": "array",
          "description": "列配置",
          "items": {
            "$ref": "#/definitions/column"
          },
          "minItems": 1
        }
      }
    },
    "dataSource": {
      "type": "object",
      "required": [
        "keyName",
        "entity",
        "diagrams"
      ],
      "properties": {
        "keyName": {
          "type": "string",
          "description": "主键字段名"
        },
        "entity": {
          "type": "string",
          "description": "实体名称"
        },
        "diagrams": {
          "type": "array",
          "description": "数据源图表配置",
          "items": {
            "$ref": "#/definitions/diagram"
          },
          "minItems": 1
        }
      }
    },
    "diagram": {
      "type": "object",
      "required": [
        "id",
        "name",
        "primaryField"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "图表ID"
        },
        "name": {
          "type": "string",
          "description": "图表名称"
        },
        "primaryField": {
          "type": "string",
          "description": "主键字段"
        },
        "parentId": {
          "type": [
            "string",
            "null"
          ],
          "format": "uuid",
          "description": "父图表ID，GUID格式，允许为空"
        },
        "type": {
          "type": "integer",
          "description": "类型"
        },
        "isMaster": {
          "type": "boolean",
          "description": "是否为主表"
        },
        "joinType": {
          "type": "integer",
          "description": "连接类型"
        },
        "diagramRelation": {
          "type": [
            "object",
            "null"
          ],
          "description": "图表关系配置，允许为空",
          "properties": {
            "primaryEntityName": {
              "type": "string",
              "description": "主实体名称"
            },
            "primaryFieldName": {
              "type": "string",
              "description": "主实体字段名"
            },
            "entityName": {
              "type": "string",
              "description": "关联实体名称"
            },
            "fieldName": {
              "type": "string",
              "description": "关联实体字段名"
            },
            "relation": {
              "type": "string",
              "description": "关系表达式"
            },
            "type": {
              "type": "string",
              "description": "关系类型"
            }
          }
        },
        "logicFormula": {
          "type": "string",
          "description": "逻辑公式"
        },
        "conditionType": {
          "type": "integer",
          "description": "条件类型"
        },
        "conditions": {
          "type": "array",
          "description": "条件列表",
          "items": {
            "$ref": "#/definitions/condition"
          }
        }
      }
    },
    "condition": {
      "type": "object",
      "required": [
        "field",
        "operatorType",
        "id",
        "dataType"
      ],
      "properties": {
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "operatorType": {
          "type": "string",
          "description": "操作符类型",
          "enum": [
            "eq",
            "ne",
            "lt",
            "le",
            "gt",
            "ge",
            "null",
            "like",
            "not-like",
            "beginwith",
            "not-null"
          ]
        },
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "条件ID"
        },
        "dataType": {
          "type": "string",
          "description": "数据类型"
        },
        "valueType": {
          "type": "integer",
          "description": "值类型",
          "enum": [
            0,
            1,
            2,
            3,
            4
          ]
        },
        "leftValueType": {
          "type": "string",
          "description": "左值类型"
        },
        "value": {
          "type": "string",
          "description": "条件值"
        }
      },
      "additionalProperties": false
    },
    "column": {
      "type": "object",
      "required": [
        "name",
        "title",
        "field",
        "id",
        "dataType"
      ],
      "properties": {
        "name": {
          "type": "string",
          "description": "列名"
        },
        "title": {
          "type": "string",
          "description": "列标题"
        },
        "width": {
          "type": "integer",
          "description": "列宽度"
        },
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "allowEdit": {
          "type": "boolean",
          "description": "是否允许编辑"
        },
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "列ID"
        },
        "isHidden": {
          "type": "boolean",
          "description": "是否隐藏"
        },
        "dataType": {
          "type": "string",
          "enum": [
            "text",
            "number",
            "date",
            "boolean"
          ],
          "description": "数据类型"
        },
        "align": {
          "type": "string",
          "enum": [
            "left",
            "center",
            "right"
          ],
          "description": "对齐方式"
        },
        "dataSourceType": {
          "type": "string",
          "description": "数据源类型"
        },
        "allowSort": {
          "type": "boolean",
          "description": "是否允许排序"
        },
        "isSummaryColumn": {
          "type": "boolean",
          "description": "是否为汇总列"
        },
        "isBold": {
          "type": "boolean",
          "description": "是否加粗"
        },
        "tips": {
          "type": "string",
          "description": "提示信息"
        },
        "textBox": {
          "$ref": "#/definitions/textBox"
        },
        "spinner": {
          "$ref": "#/definitions/spinner"
        },
        "datePicker": {
          "$ref": "#/definitions/datePicker"
        },
        "comboBox": {
          "$ref": "#/definitions/comboBox"
        }
      }
    },
    "textBox": {
      "type": "object",
      "required": [
        "id",
        "field"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "文本框ID"
        },
        "field": {
          "type": "string",
          "description": "字段名"
        }
      }
    },
    "spinner": {
      "type": "object",
      "required": [
        "id",
        "field"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "数字输入框ID"
        },
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "precision": {
          "type": "integer",
          "description": "精度"
        },
        "precisionType": {
          "type": [
            "string",
            "integer"
          ],
          "description": "精度类型"
        },
        "rounding": {
          "type": "integer",
          "description": "舍入方式"
        },
        "roundingType": {
          "type": [
            "string",
            "integer"
          ],
          "description": "舍入类型"
        },
        "showThousandths": {
          "type": "boolean",
          "description": "是否显示千分位"
        },
        "unitText": {
          "type": "string",
          "description": "单位文本"
        },
        "unitTextType": {
          "type": [
            "string",
            "integer"
          ],
          "description": "单位文本类型"
        },
        "minValue": {
          "type": [
            "string",
            "integer"
          ],
          "description": "最小值"
        },
        "maxValue": {
          "type": [
            "string",
            "integer"
          ],
          "description": "最大值"
        },
        "minOperatorType": {
          "type": "string",
          "description": "最小值操作符类型"
        },
        "maxOperatorType": {
          "type": "string",
          "description": "最大值操作符类型"
        }
      }
    },
    "datePicker": {
      "type": "object",
      "required": [
        "id",
        "field"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "日期选择器ID"
        },
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "format": {
          "type": "string",
          "description": "日期格式"
        }
      }
    },
    "comboBox": {
      "type": "object",
      "required": [
        "id",
        "field"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "下拉框ID"
        },
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "optionDataType": {
          "type": "string",
          "description": "选项数据类型"
        },
        "optionsType": {
          "type": "string",
          "description": "选项类型"
        },
        "options": {
          "type": "array",
          "description": "选项列表",
          "items": {
            "$ref": "#/definitions/option"
          }
        }
      }
    },
    "option": {
      "type": "object",
      "required": [
        "value",
        "text"
      ],
      "properties": {
        "value": {
          "type": "string",
          "description": "选项值"
        },
        "text": {
          "type": "string",
          "description": "选项文本"
        },
        "isDefault": {
          "type": "boolean",
          "description": "是否为默认选项"
        },
        "disabled": {
          "type": "boolean",
          "description": "是否禁用"
        }
      }
    },
    "ruleConfig": {
      "type": "object",
      "required": [
        "id",
        "title",
        "controlId",
        "controlType",
        "controlProp",
        "controlName",
        "handles"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "规则配置ID"
        },
        "title": {
          "type": "string",
          "description": "规则标题"
        },
        "controlId": {
          "type": "string",
          "format": "uuid",
          "description": "控件ID"
        },
        "controlType": {
          "type": "string",
          "description": "控件类型"
        },
        "controlSubType": {
          "type": "string",
          "description": "控件子类型"
        },
        "controlProp": {
          "type": "string",
          "description": "控件属性"
        },
        "controlName": {
          "type": "string",
          "description": "控件名称"
        },
        "handles": {
          "type": "array",
          "description": "处理器列表",
          "items": {
            "$ref": "#/definitions/handle"
          },
          "minItems": 1
        }
      }
    },
    "handle": {
      "type": "object",
      "required": [
        "handleId",
        "ruleId",
        "action"
      ],
      "properties": {
        "handleId": {
          "type": "string",
          "format": "uuid",
          "description": "处理器ID"
        },
        "ruleId": {
          "type": "string",
          "format": "uuid",
          "description": "规则ID"
        },
        "action": {
          "type": "string",
          "description": "动作"
        },
        "value": {
          "type": "string",
          "description": "值"
        }
      }
    },
    "ruleGroup": {
      "type": "object",
      "required": [
        "id",
        "title",
        "rule"
      ],
      "properties": {
        "id": {
          "type": "string",
          "format": "uuid",
          "description": "规则组ID"
        },
        "title": {
          "type": "string",
          "description": "规则组标题"
        },
        "rule": {
          "$ref": "#/definitions/ruleDefinition"
        }
      }
    },
    "ruleDefinition": {
      "type": "object",
      "required": [
        "condition",
        "rules"
      ],
      "properties": {
        "condition": {
          "type": "string",
          "enum": [
            "AND",
            "OR"
          ],
          "description": "条件类型：AND或OR"
        },
        "rules": {
          "type": "array",
          "description": "规则列表",
          "items": {
            "$ref": "#/definitions/ruleItem"
          },
          "minItems": 1
        }
      }
    },
    "ruleItem": {
      "type": "object",
      "required": [
        "action",
        "field",
        "operator",
        "type",
        "value",
        "valueType"
      ],
      "properties": {
        "action": {
          "type": "string",
          "description": "动作"
        },
        "field": {
          "type": "string",
          "description": "字段"
        },
        "operator": {
          "type": "string",
          "description": "操作符"
        },
        "type": {
          "type": "string",
          "description": "类型"
        },
        "value": {
          "type": "string",
          "description": "值"
        },
        "valueType": {
          "type": "string",
          "description": "值"
        }
      }
    },
    "projectSelect": {
      "type": "object",
      "required": [
        "field"
      ],
      "properties": {
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "filterType": {
          "type": "string",
          "description": "过滤类型"
        },
        "displayType": {
          "type": "string",
          "description": "显示类型"
        },
        "filterMethod": {
          "type": "string",
          "description": "过滤方法"
        },
        "inherit": {
          "type": "string",
          "description": "继承"
        },
        "filterable": {
          "type": "boolean",
          "description": "是否可过滤"
        },
        "cascade": {
          "type": "boolean",
          "description": "是否级联"
        },
        "label2": {
          "type": "string",
          "description": "第二标签"
        },
        "displayType2": {
          "type": "string",
          "description": "第二显示类型"
        }
      }
    },
    "searchFilter": {
      "type": "object",
      "required": [
        "field",
        "fields"
      ],
      "properties": {
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "fields": {
          "type": "array",
          "description": "搜索字段列表",
          "items": {
            "type": "object",
            "required": [
              "field",
              "title"
            ],
            "properties": {
              "field": {
                "type": "string",
                "description": "字段名"
              },
              "title": {
                "type": "string",
                "description": "字段标题"
              }
            }
          }
        }
      }
    },
    "comboBoxFilter": {
      "type": "object",
      "required": [
        "field"
      ],
      "properties": {
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "optionsType": {
          "type": "string",
          "description": "选项类型"
        },
        "allowEmpty": {
          "type": "boolean",
          "description": "是否允许为空"
        },
        "multiSelect": {
          "type": "boolean",
          "description": "是否多选"
        },
        "allowClear": {
          "type": "boolean",
          "description": "是否允许清空"
        },
        "filterable": {
          "type": "boolean",
          "description": "是否可过滤"
        },
        "operatorType": {
          "type": "string",
          "description": "操作符类型"
        },
        "options": {
          "type": "array",
          "description": "选项列表",
          "items": {
            "$ref": "#/definitions/option"
          }
        }
      }
    },
    "dateRangeFilter": {
      "type": "object",
      "required": [
        "field"
      ],
      "properties": {
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "format": {
          "type": "string",
          "description": "日期格式"
        },
        "dataFrom": {
          "type": "string",
          "description": "数据来源"
        },
        "allowClear": {
          "type": "boolean",
          "description": "是否允许清空"
        },
        "options": {
          "type": "array",
          "description": "选项列表",
          "items": {
            "$ref": "#/definitions/option"
          }
        }
      }
    },
    "numberRangeFilter": {
      "type": "object",
      "required": [
        "field"
      ],
      "properties": {
        "field": {
          "type": "string",
          "description": "字段名"
        },
        "precision": {
          "type": "integer",
          "description": "精度"
        },
        "precisionType": {
          "type": [
            "string",
            "integer"
          ],
          "description": "精度类型"
        },
        "rounding": {
          "type": "integer",
          "description": "舍入方式"
        },
        "roundingType": {
          "type": [
            "string",
            "integer"
          ],
          "description": "舍入类型"
        },
        "showThousandths": {
          "type": "boolean",
          "description": "是否显示千分位"
        },
        "allowZero": {
          "type": "boolean",
          "description": "是否允许零值"
        },
        "showPercentage": {
          "type": "boolean",
          "description": "是否显示百分比"
        },
        "unitTextType": {
          "type": [
            "string",
            "integer"
          ],
          "description": "单位文本类型"
        },
        "minValue": {
          "type": [
            "string",
            "integer"
          ],
          "description": "最小值"
        },
        "maxValue": {
          "type": [
            "string",
            "integer"
          ],
          "description": "最大值"
        },
        "minOperatorType": {
          "type": "string",
          "description": "最小值操作符类型"
        },
        "maxOperatorType": {
          "type": "string",
          "description": "最大值操作符类型"
        },
        "options": {
          "type": "array",
          "description": "选项列表",
          "items": {
            "type": "object",
            "required": [
              "fromValue",
              "toValue",
              "text"
            ],
            "properties": {
              "fromValue": {
                "type": [
                  "string",
                  "integer"
                ],
                "description": "起始值"
              },
              "toValue": {
                "type": [
                  "string",
                  "integer"
                ],
                "description": "结束值"
              },
              "text": {
                "type": "string",
                "description": "显示文本"
              },
              "isDefault": {
                "type": "boolean",
                "description": "是否为默认选项"
              }
            }
          }
        }
      }
    }
  }
}