# CCDebug - Claude Code è°ƒè¯•å·¥å…·


CCDebug æ˜¯ä¸€ä¸ªé’ˆå¯¹ Claude Code çš„è°ƒè¯•å·¥å…·ï¼Œç”¨äºè®°å½•å¹¶å¯è§†åŒ– CC è¿è¡Œè½¨è¿¹ï¼ŒåŒæ—¶æ”¯æŒå¯¹å•ä¸ª LLM è¯·æ±‚è¿›è¡Œâ€œä¿®æ”¹-é‡æ”¾â€ï¼Œå¸®åŠ©ä½ å¿«é€Ÿå®šä½æç¤ºè¯/ä¸Šä¸‹æ–‡/å·¥å…·è°ƒç”¨å¯¼è‡´çš„åå·®ã€‚ï¼ˆæœ¬é¡¹ç›®åŸºäº [lemmy/claude-trace](https://github.com/badlogic/lemmy/tree/main/apps/claude-trace) äºŒæ¬¡å¼€å‘ï¼‰

[>>English README](./README.en.md)

## âœ¨ ä¸»è¦åŠŸèƒ½

### **1ã€æ—¶é—´çº¿å±•ç¤ºè½¨è¿¹**
- **æŒ‰CCæ‰§è¡Œæ­¥éª¤æ˜¾ç¤º**: å¯ä»¥åŒºåˆ†ä¸åŒç±»å‹æ—¥å¿—ï¼Œç”¨æˆ·è¾“å…¥ã€LLMå›å¤ã€å·¥å…·è°ƒç”¨ç­‰
- **æ”¯æŒæ­¥éª¤è¯¦æƒ…**: å¯ä»¥å¿«é€ŸæŸ¥çœ‹æŸä¸€æ­¥çš„åŸå§‹CCæ—¥å¿—å†…å®¹
  
![æ—¶é—´çº¿å±•ç¤ºCCè¿è¡Œè½¨è¿¹](./docs/img/1ã€æ—¥å¿—ä»¥æ—¶é—´çº¿å½¢å¼å±•ç¤º.png)

### **2ã€å¿«é€Ÿåˆ‡æ¢æ—¥å¿—**
- **ä¸€é”®è·³è½¬SubAgentæ—¥å¿—**: ä¸€é”®è·³è½¬åˆ°å­ä»£ç†æ—¥å¿—ï¼Œæ–¹ä¾¿æŸ¥çœ‹å­ä»£ç†çš„è¿è¡Œè½¨è¿¹
- **å¿«é€Ÿåˆ‡æ¢é¡¹ç›®å’Œä¼šè¯**: ç›´æ¥åˆ‡æ¢ `~/.claude/projects` ä¸‹çš„ä¸åŒé¡¹ç›®å’Œä¼šè¯ï¼Œæ— éœ€å¯åŠ¨å¤šæ¬¡å·¥å…·

![å¿«é€Ÿåˆ‡æ¢é¡¹ç›®å’Œä¼šè¯](./docs/img/2ã€å¿«é€Ÿåˆ‡æ¢é¡¹ç›®å’Œä¼šè¯.gif)

### **3ã€å¿«é€Ÿæœç´¢å®šä½**
- **å…¨å±€æœç´¢å…³é”®å­—**: å¯ä»¥å¿«é€Ÿå®šä½åˆ°åŒ…å«æŒ‡å®šå…³é”®å­—çš„æ—¥å¿—ï¼ˆæœç´¢å½“å‰ä¼šè¯ä¸‹æ‰€æœ‰æ—¥å¿—æ–‡ä»¶ï¼‰
- **æ­¥éª¤æ¦‚è§ˆè¿‡æ»¤**: æ­¥éª¤æ¦‚è§ˆæ˜¾ç¤ºæ‰§è¡Œå…¨è²Œï¼Œå¯æŒ‰ä¸åŒç±»å‹çš„æ—¶é—´çº¿èŠ‚ç‚¹è¿‡æ»¤
- **ç”Ÿæˆåˆ†äº«é“¾æ¥**: å¯ä»¥ç”Ÿæˆå½“å‰ä¼šè¯çš„åˆ†äº«é“¾æ¥ï¼Œæ–¹ä¾¿å¤šäººåä½œåˆ†æ

![å¿«é€Ÿæœç´¢å®šä½](./docs/img/3ã€å¿«é€Ÿæœç´¢å®šä½.gif)

### **4ã€å¿«é€Ÿåˆ†æè€—æ—¶**
- **æ˜¾ç¤ºæ­¥éª¤å¼€å§‹æ—¶é—´**: æ¯ä¸ªæ—¥å¿—èŠ‚ç‚¹æ˜¾ç¤ºå½“å‰æ­¥éª¤çš„å¼€å§‹æ—¶é—´
- **æ˜¾ç¤ºå·¥å…·è°ƒç”¨è€—æ—¶**: å¯¹äºå·¥å…·è°ƒç”¨ã€SubAgentæ‰§è¡Œçš„æ­¥éª¤ï¼ŒèŠ‚ç‚¹å°†æ˜¾ç¤ºè°ƒç”¨è€—æ—¶
- **ç»Ÿè®¡æ­¥éª¤é—´è€—æ—¶**: ç”¨æˆ·å¯ä»¥æ ‡è®°2ä¸ªæ­¥éª¤èŠ‚ç‚¹ï¼Œå…±è®¡è‡ªåŠ¨è®¡ç®—å¹¶æ˜¾ç¤º2ä¸ªèŠ‚ç‚¹é—´è€—æ—¶

![å¿«é€Ÿåˆ†æè€—æ—¶](./docs/img/4ã€å¿«é€Ÿåˆ†æè€—æ—¶.gif)

### **5ã€å¯¹CCæ­¥éª¤å•ç‚¹è°ƒè¯•**
> æ³¨æ„ï¼šè°ƒè¯•åŠŸèƒ½ä»…æ”¯æŒNPMè„šæœ¬å½¢å¼å®‰è£…çš„ Claude Codeï¼Œä¸æ”¯æŒåŸç”ŸäºŒè¿›åˆ¶ç‰ˆæœ¬ã€‚

![å¯¹CCæ­¥éª¤å•ç‚¹è°ƒè¯•](./docs/img/LLMè¯·æ±‚è°ƒè¯•.png)
- **è¿½è¸ªLLMè¯·æ±‚**: è¯¦ç»†è®°å½•CCå¯¹LLMçš„æ‰€æœ‰è¯·æ±‚æ—¥å¿—
- **é‡æ–°å‘é€LLMè¯·æ±‚**: æ”¯æŒä¿®æ”¹LLMè¯·æ±‚æ•°æ®ï¼Œé‡æ–°å‘é€è¯·æ±‚ï¼Œæ–¹ä¾¿åå¤éªŒè¯LLMçš„å“åº”æ˜¯å¦ç¬¦åˆé¢„æœŸ

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å®‰è£…

```bash
# æ¨èï¼šä» npm å…¨å±€å®‰è£…
npm install -g @myskyline_ai/ccdebug

# æˆ–ï¼šå®‰è£…æœ¬åœ°/å‘å¸ƒäº§ç‰© tgz
# npm install -g /path/to/@myskyline_ai-ccdebug-x.y.z.tgz
```

### åŸºæœ¬ä½¿ç”¨

#### 1. å¯åŠ¨ Claude å¹¶è®°å½•äº¤äº’

```bash
# åŸºæœ¬ç”¨æ³• - å¯åŠ¨ Claude å¹¶è‡ªåŠ¨è®°å½•
ccdebug

# åŒ…å«æ‰€æœ‰è¯·æ±‚ï¼ˆä¸ä»…ä»…æ˜¯å¯¹è¯ï¼‰
ccdebug --include-all-requests

# å°†åç»­å‚æ•°ä¼ é€’ç»™ Claude è¿›ç¨‹ï¼ˆç¤ºä¾‹ï¼‰
ccdebug --run-with -p "è¯·æŒ‰è¦æ±‚å·¥ä½œ" --verbose
```

#### 2. å¯åŠ¨ Web ç«™ç‚¹æŸ¥çœ‹æ—¶é—´çº¿è½¨è¿¹

```bash
# å¯åŠ¨ Web æœåŠ¡å™¨æŸ¥çœ‹æ—¶é—´çº¿ï¼ˆé»˜è®¤ç«¯å£ 3001ï¼Œé»˜è®¤é¡¹ç›®ç›®å½•ä¸ºå½“å‰ç›®å½•ï¼‰
ccdebug -l

# åœ¨è‡ªå®šä¹‰ç«¯å£å¯åŠ¨
ccdebug -l --port 3001

# æŒ‡å®šé¡¹ç›®ç›®å½•å¯åŠ¨
ccdebug -l --project /path/to/your/cc_workdir
```

### æ—¥å¿—è¾“å‡ºç›®å½•

- **CC æ ‡å‡†æ—¥å¿—ï¼ˆç”¨äºæ—¶é—´çº¿ï¼‰**: `.claude-trace/cclog/*.jsonl`ï¼ˆåŒ…å«ä¸»æ—¥å¿—ä¸ `agent-*.jsonl` å­ä»£ç†æ—¥å¿—ï¼‰
- **CC API è·Ÿè¸ªæ—¥å¿—ï¼ˆç”¨äº LLM è¯·æ±‚è°ƒè¯•ï¼‰**: `.claude-trace/tracelog/*.jsonl`
- **å·²ä¿å­˜çš„ LLM è¯·æ±‚ï¼ˆç”¨äºè¦†ç›–/é‡æ”¾ï¼‰**: `.claude-trace/tracelog/llm_requests/*.json`

è¯´æ˜ï¼š

- è¿è¡Œ `ccdebug` å¯åŠ¨ Claude ä¼šè¯åï¼Œä¼šå°†æœ¬æ¬¡ä¼šè¯å¯¹åº”çš„ CC æ ‡å‡†æ—¥å¿—è‡ªåŠ¨æ‹·è´åˆ° `.claude-trace/cclog/`ï¼Œå¹¶å°† API è·Ÿè¸ªæ—¥å¿—é‡å‘½åä¸º `{sessionId}.jsonl`ã€‚
- å¦‚æœä½ ä½¿ç”¨çš„æ˜¯ Claude Code **åŸç”ŸäºŒè¿›åˆ¶ç‰ˆæœ¬**ï¼ˆé NPM è„šæœ¬å½¢å¼ï¼‰ï¼ŒCCDebug æ— æ³•æ‹¦æˆª API è¯·æ±‚ï¼ŒLLM è¯·æ±‚è°ƒè¯•èƒ½åŠ›å°†ä¸å¯ç”¨ï¼ˆä»å¯é€šè¿‡ Web ç«™ç‚¹æŸ¥çœ‹å·²æœ‰ CC æ ‡å‡†æ—¥å¿—ï¼‰ã€‚

## ğŸ“‹ å‘½ä»¤è¡Œé€‰é¡¹

| é€‰é¡¹ | æè¿° |
|------|------|
| `--log, -l` | å¯åŠ¨ Web æ—¶é—´çº¿æœåŠ¡å™¨ï¼ˆå½“ `--log` ä¸å¸¦å‚æ•°æ—¶ç­‰åŒäº `--serve`ï¼›å»ºè®®ç”¨ `-l` é¿å…ä¸ `--log <name>` æ··æ·†ï¼‰ |
| `--port <number>` | æŒ‡å®š Web æœåŠ¡å™¨ç«¯å£ï¼ˆé»˜è®¤ 3001ï¼‰ |
| `--project <path>` | æŒ‡å®šé¡¹ç›®ç›®å½•è·¯å¾„ |
| `--run-with <args>` | å°†åç»­å‚æ•°ä¼ é€’ç»™ Claude è¿›ç¨‹ |
| `--include-all-requests` | åŒ…å«æ‰€æœ‰ fetch è¯·æ±‚ï¼Œè€Œä¸ä»…ä»…æ˜¯å¯¹è¯ |
| `--claude-path <path>` | æŒ‡å®š Claude äºŒè¿›åˆ¶æ–‡ä»¶çš„è‡ªå®šä¹‰è·¯å¾„ |
| `--index` | ä¸º `.claude-trace/` ç›®å½•ç”Ÿæˆå¯¹è¯æ‘˜è¦å’Œç´¢å¼•ï¼ˆä¼šè°ƒç”¨ Claude äº§ç”Ÿé¢å¤– token æ¶ˆè€—ï¼‰ |
| `--version, -v` | æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ |
| `--help, -h` | æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯ |

## ğŸ—ï¸ æŠ€æœ¯æ¶æ„

### æ ¸å¿ƒç»„ä»¶

- **HTTP/API æ‹¦æˆªå™¨**: åŸºäº Node.js çš„ HTTP/HTTPS + fetch æ‹¦æˆªæœºåˆ¶ï¼Œè®°å½•å¯¹ Anthropic/Bedrock çš„è¯·æ±‚ä¸å“åº”
- **CC æ ‡å‡†æ—¥å¿—æ•´ç†**: é€€å‡ºä¼šè¯æ—¶è‡ªåŠ¨å°† CC æ ‡å‡†æ—¥å¿—ï¼ˆä¸»æ—¥å¿—ä¸å­ä»£ç†æ—¥å¿—ï¼‰æ‹·è´åˆ° `.claude-trace/cclog/`
- **Web æœåŠ¡å™¨**: Express.js æä¾›æ–‡ä»¶åˆ—è¡¨ã€ä¼šè¯ç®¡ç†ã€é¡¹ç›®åˆ‡æ¢ã€LLM è¯·æ±‚è¯»å–/ä¿å­˜/é‡æ”¾ç­‰ API
- **å‰ç«¯ç•Œé¢**: Vue 3 + Vite + Pinia + Arco Design

### æ•°æ®æµç¨‹

```
HTTP è¯·æ±‚/å“åº” â†’ æ‹¦æˆªå™¨ â†’ åŸå§‹æ•°æ®(JSONL) â†’ æ•°æ®å¤„ç†å™¨ â†’ ç»“æ„åŒ–æ•°æ® â†’ Web ç•Œé¢å±•ç¤º
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
ccdebug/
â”œâ”€â”€ src/                     # CLI ä¸æ‹¦æˆªå™¨
â”‚   â”œâ”€â”€ cli.ts              # å‘½ä»¤è¡Œå…¥å£
â”‚   â”œâ”€â”€ interceptor.ts      # API æ‹¦æˆªä¸ tracelog è®°å½•
â”‚   â”œâ”€â”€ html-generator.ts   # HTML æŠ¥å‘Šç”Ÿæˆå™¨ï¼ˆåŸºäº frontendï¼‰
â”‚   â””â”€â”€ index-generator.ts  # å¯¹è¯æ‘˜è¦ä¸ç´¢å¼•ç”Ÿæˆ
â”œâ”€â”€ web/                     # Web æ—¶é—´çº¿ç«™ç‚¹ï¼ˆVite + Vue 3ï¼‰
â”‚   â”œâ”€â”€ src/                # å‰ç«¯æºç 
â”‚   â”œâ”€â”€ dist/               # æ„å»ºäº§ç‰©
â”‚   â””â”€â”€ server/             # Express åç«¯ï¼ˆä¾› CLI ç›´æ¥ require å¯åŠ¨ï¼‰
â”œâ”€â”€ frontend/                # ç‹¬ç«‹ HTML æŠ¥å‘Šå‰ç«¯ï¼ˆbundle æ³¨å…¥åˆ° HTMLï¼‰
â”œâ”€â”€ scripts/                 # æ‰“åŒ…è„šæœ¬
â””â”€â”€ docs/                    # æ–‡æ¡£ä¸è®¾è®¡è¯´æ˜
```

## ğŸ”§ å¼€å‘

### ç¯å¢ƒè¦æ±‚

- Node.js >= 16.0.0
- npm æˆ– yarn

### æœ¬åœ°å¼€å‘

```bash
# å…‹éš†é¡¹ç›®
git clone https://github.com/ThinkingBeing/ccdebug.git
cd ccdebug

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºé¡¹ç›®
npm run build

# å¼€å‘æ¨¡å¼ï¼ˆåŒæ—¶ watch æ ¸å¿ƒä»£ç  + å‰ç«¯ï¼‰
npm run dev

# ä½¿ç”¨ tsx ç›´æ¥è¿è¡Œ CLIï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰
npx tsx src/cli.ts --help
npx tsx src/cli.ts -l --port 3001 --project /path/to/your/cc_workdir

# åŠŸèƒ½okåæ‰“åŒ…ï¼ŒåŒ…ä¼šå‡ºç°åœ¨releaseç›®å½•
npm run package
```

## ğŸ”— ç›¸å…³é“¾æ¥

- [GitHub ä»“åº“](https://github.com/ThinkingBeing/ccdebug)
